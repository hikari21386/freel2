<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>家計簿 </title>
<!-- シンプルなスタイル。淡いピンク基調。個人は色分け -->
<style>
:root{
--bg:#fff7f8; /* 淡いピンク */
--card:#fff;
--hikari:#ffd7e0; /* ピンク */
--akito:#d7f0ff; /* 水色 */
--ayumi:#ffc6c6; /* 赤寄り */
--text:#333;
--muted:#666;
--accent:#ff7aa2;
--radius:12px;
--glass: rgba(255,255,255,0.65);*{box-sizing:border-box}
document.getElementById('importBtn').addEventListener('click', ()=>document.getElementById('importFile').click());
document.getElementById('importFile').addEventListener('change', function(e){const f=this.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{try{state=JSON.parse(r.result); saveState(); alert('インポート完了'); renderAll();}catch(err){alert('読み込み失敗')}}; r.readAsText(f)});


// clear data
document.getElementById('clearBtn').addEventListener('click', ()=>{if(confirm('本当にこのブラウザの全データを消しますか？')){localStorage.removeItem(storageKey); state={accounts:{},active:null}; alert('消したよ'); renderAll();}});


// filters
document.getElementById('personFilter').addEventListener('change', renderAll);


// charts
let barChart=null, pieChart=null;
function drawCharts(month){
const labels=[]; const barData=[]; const pieLabels=[]; const pieData=[];
// build category sums for the month
const sumsByCategory={}; let totalIncome=0; let totalExpense=0;
const recs = getAllRecordsForMonth(month);
recs.forEach(r=>{
const v=r.categoryValue; if(!sumsByCategory[v]) sumsByCategory[v]=0; sumsByCategory[v]+=r.amount;
if(v.startsWith('income')) totalIncome+=r.amount; else totalExpense+=r.amount;
});
for(const k in sumsByCategory){ labels.push(k); barData.push(sumsByCategory[k]); pieLabels.push(k); pieData.push(sumsByCategory[k]); }


const ctx=document.getElementById('barChart').getContext('2d');
if(barChart) barChart.destroy();
barChart=new Chart(ctx,{type:'bar',data:{labels:labels, datasets:[{label:'カテゴリ別',data:barData}]}, options:{responsive:true}});


const ctx2=document.getElementById('pieChart').getContext('2d'); if(pieChart) pieChart.destroy();
pieChart=new Chart(ctx2,{type:'pie',data:{labels:pieLabels,datasets:[{data:pieData}]}, options:{responsive:true}});
}


function getAllRecordsForMonth(month){
// month is YYYY-MM or empty -> all
if(!state.active) return [];
const all=state.accounts[state.active].records||[];
if(!month) return all;
return all.filter(r=>r.date.slice(0,7)===month);
}


// render UI
function renderAll(){
const list=document.getElementById('recordsList'); list.innerHTML='';
const catSumsDiv=document.getElementById('categorySums'); catSumsDiv.innerHTML='';
if(!state.active){acctMsg('ログインしてね'); return}
const recs = state.accounts[state.active].records||[];
const personFilter=document.getElementById('personFilter').value;


const sumsByCat={}; let houseIncome=0, houseExpense=0;


recs.forEach(r=>{
const li=document.createElement('li'); li.className='record';
const left=document.createElement('div'); left.className='left';
const badge=document.createElement('div'); badge.className='badge'; badge.textContent=r.owner; badge.style.background=(r.owner==='hikari'?getComputedStyle(document.documentElement).getPropertyValue('--hikari'):(r.owner==='akito'?getComputedStyle(document.documentElement).getPropertyValue('--akito'):getComputedStyle(document.documentElement).getPropertyValue('--ayumi')));
left.appendChild(badge);
const txt=document.createElement('div'); txt.innerHTML=`<strong>${r.categoryLabel}</strong><div class="small">${r.date} / ${r.payType}</div>`;
left.appendChild(txt);
const right=document.createElement('div'); right.innerHTML=`<div style="text-align:right"><div>${r.amount} 円</div><div class="small">${r.id}</div></div>`;
li.appendChild(left); li.appendChild(right);


// apply filter
if(personFilter==='all' || personFilter===r.owner) list.appendChild(li);


// sums
if(!sumsByCat[r.categoryLabel]) sumsByCat[r.categoryLabel]=0; sumsByCat[r.categoryLabel]+=r.amount;
if(r.categoryValue.startsWith('income')) houseIncome += r.amount; else houseExpense += r.amount;
});


// category list
const ul=document.createElement('ul'); for(const k in sumsByCat){const it=document.createElement('li'); it.textContent=`${k}: ${sumsByCat[k]} 円`; ul.appendChild(it);} catSumsDiv.appendChild(ul);
document.getElementById('houseIncome').textContent = houseIncome;
document.getElementById('houseExpense').textContent = houseExpense;
document.getElementById('net').textContent = (houseIncome - houseExpense);
}


// initial
renderAll();


// draw charts button
document.getElementById('drawBtn').addEventListener('click', ()=>{
const month=document.getElementById('monthPicker').value; drawCharts(month);
});


// load sample data helper (for demo) — optional
function loadSample(){
const name='demo'; state.accounts[name]={passwordHash:'',records:[
{id:uid(),date:'2025-09-01',categoryValue:'income_salary',categoryLabel:'基本給',amount:250000,owner:'hikari',payType:'bank'},
{id:uid(),date:'2025-09-02',categoryValue:'expense_rent',categoryLabel:'家賃',amount:60000,owner:'hikari',payType:'bank'},
{id:uid(),date:'2025-09-05',categoryValue:'expense_util',categoryLabel:'光熱費',amount:12000,owner:'akito',payType:'card'},
{id:uid(),date:'2025-09-07',categoryValue:'expense_cat',categoryLabel:'猫の支出',amount:7000,owner:'hikari',payType:'cash'},
]}; state.active=name; saveState(); renderAll(); acctMsg('デモデータ読み込み'); }


// optional demo loader
if(!state.active && Object.keys(state.accounts).length===0){loadSample();
  
}
</div>
<div id="acctMsg" class="small" style="margin-top:8px"></div>

import React, { useState } from "react";
import { PieChart, Pie, Cell, Tooltip, Legend } from "recharts";

export default function BudgetApp() {
  const [view, setView] = useState("収入");

  // 収入項目
  const [income, setIncome] = useState({
    基本給: 0,
    固定残業代: 0,
    通勤手当: 0,
    ボーナス: 0,
    TikTok_ギフト: 0,
    TikTok_サブスク: 0,
    YouTube収益: 0,
    メルカリ収益: 0,
    BASE収益: 0,
  });

  // 支出項目
  const [expense, setExpense] = useState({
    家賃: 0,
    健康保険料: 0,
    厚生年金: 0,
    雇用保険: 0,
    所得税: 0,
    住民税: 0,
    立替金: 0,
    欠勤控除: 0,
    クレジットカード: 0,
    現金: 0,
    サブスク: 0,
    保険: 0,
    食材費: 0,
    外食: 0,
    車: 0,
    交通費: 0,
    医療費: 0,
    日用品: 0,
    消耗品: 0,
    活動経費: 0,
    旅行費: 0,
    交際費: 0,
    猫費用: 0,
  });

  // 合計値
  const totalIncome = Object.values(income).reduce((a, b) => a + Number(b), 0);
  const totalExpense = Object.values(expense).reduce((a, b) => a + Number(b), 0);
  const balance = totalIncome - totalExpense;

  // 円グラフ用データ
  const pieData = Object.entries(expense)
    .filter(([_, v]) => Number(v) > 0)
    .map(([k, v]) => ({ name: k, value: Number(v) }));

  const COLORS = [
    "#FFB6C1", "#87CEFA", "#FF6347", "#FFD700", "#ADFF2F",
    "#20B2AA", "#9370DB", "#FF69B4", "#FFA500", "#40E0D0"
  ];

  return (
    <div className="p-6 max-w-2xl mx-auto bg-pink-50 rounded-xl shadow">
      {/* ナビゲーション */}
      <div className="flex gap-2 mb-6">
        {["収入", "支出", "集計"].map((tab) => (
          <button
            key={tab}
            onClick={() => setView(tab)}
            className={`px-4 py-2 rounded-full ${
              view === tab ? "bg-pink-400 text-white" : "bg-gray-200"
            }`}
          >
            {tab}
          </button>
        ))}
      </div>

      {/* 収入タブ */}
      {view === "収入" && (
        <div>
          <h2 className="text-xl font-bold mb-4 text-pink-600">収入入力</h2>
          {Object.keys(income).map((key) => (
            <div key={key} className="mb-3">
              <label className="block mb-1">{key}</label>
              <input
                type="number"
                value={income[key]}
                onChange={(e) =>
                  setIncome({ ...income, [key]: e.target.value })
                }
                className="border p-2 w-full rounded"
              />
            </div>
          ))}
        </div>
      )}

      {/* 支出タブ */}
      {view === "支出" && (
        <div>
          <h2 className="text-xl font-bold mb-4 text-pink-600">支出入力</h2>
          {Object.keys(expense).map((key) => (
            <div key={key} className="mb-3">
              <label className="block mb-1">{key}</label>
              <input
                type="number"
                value={expense[key]}
                onChange={(e) =>
                  setExpense({ ...expense, [key]: e.target.value })
                }
                className="border p-2 w-full rounded"
              />
            </div>
          ))}
        </div>
      )}

      {/* 集計タブ */}
      {view === "集計" && (
        <div>
          <h2 className="text-xl font-bold mb-4 text-pink-600">集計結果</h2>
          <p className="mb-2">収入合計: {totalIncome} 円</p>
          <p className="mb-2">支出合計: {totalExpense} 円</p>
          <p className="mb-4 font-bold">
            残高:{" "}
            <span className={balance >= 0 ? "text-green-600" : "text-red-600"}>
              {balance} 円
            </span>
          </p>

          {/* 円グラフ */}
          {pieData.length > 0 ? (
            <PieChart width={400} height={300}>
              <Pie
                data={pieData}
                cx="50%"
                cy="50%"
                outerRadius={100}
                dataKey="value"
                label
              >
                {pieData.map((_, index) => (
                  <Cell
                    key={`cell-${index}`}
                    fill={COLORS[index % COLORS.length]}
                  />
                ))}
              </Pie>
              <Tooltip />
              <Legend />
            </PieChart>
          ) : (
            <p className="text-gray-500">支出データがありません</p>
          )}
        </div>
      )}
    </div>
  );
}
 import React, { useState } from "react";
import { PieChart, Pie, Cell, Tooltip, Legend } from "recharts";

export default function BudgetApp() {
  const [view, setView] = useState("収入");

  const owners = [
    { key: "hikari", label: "ひかり", color: "#FFB6C1" },
    { key: "akito", label: "あきと", color: "#87CEFA" },
    { key: "ayumi", label: "あゆみ", color: "#FF6347" },
    { key: "edel", label: "エーデル", color: "#FFD700" },
    { key: "aster", label: "アスター", color: "#ADFF2F" },
    { key: "lewisia", label: "レウィシア", color: "#20B2AA" },
  ];

  // 収入
  const [income, setIncome] = useState({
    基本給: { amount: 0, owner: "hikari" },
    固定残業代: { amount: 0, owner: "hikari" },
    通勤手当: { amount: 0, owner: "hikari" },
    ボーナス: { amount: 0, owner: "hikari" },
    TikTok_ギフト: { amount: 0, owner: "hikari" },
    TikTok_サブスク: { amount: 0, owner: "hikari" },
    YouTube収益: { amount: 0, owner: "hikari" },
    メルカリ収益: { amount: 0, owner: "hikari" },
    BASE収益: { amount: 0, owner: "hikari" },
  });

  // 支出
  const [expense, setExpense] = useState({
    家賃: { amount: 0, owner: "hikari" },
    健康保険料: { amount: 0, owner: "hikari" },
    厚生年金: { amount: 0, owner: "hikari" },
    光熱費: { amount: 0, owner: "hikari" },
    交通費: { amount: 0, owner: "hikari" },
    猫費用: { amount: 0, owner: "edel" },
    食材費: { amount: 0, owner: "hikari" },
    外食: { amount: 0, owner: "hikari" },
    クレジットカード: { amount: 0, owner: "hikari" },
  });

  // 合計計算
  const totalIncome = Object.values(income).reduce((acc, i) => acc + Number(i.amount), 0);
  const totalExpense = Object.values(expense).reduce((acc, e) => acc + Number(e.amount), 0);
  const balance = totalIncome - totalExpense;

  // 集計用データ（owner別）
  const totalByOwner = {};
  [...Object.values(income), ...Object.values(expense)].forEach(item => {
    totalByOwner[item.owner] = (totalByOwner[item.owner] || 0) + Number(item.amount);
  });

  // 円グラフ用
  const pieData = Object.entries(totalByOwner).map(([owner, value]) => ({
    name: owners.find(o => o.key === owner)?.label || owner,
    value,
    color: owners.find(o => o.key === owner)?.color || "#ccc",
  }));

  return (
    <div className="p-6 max-w-3xl mx-auto bg-pink-50 rounded-xl shadow">
      {/* タブ */}
      <div className="flex gap-2 mb-6">
        {["収入", "支出", "集計"].map(tab => (
          <button
            key={tab}
            onClick={() => setView(tab)}
            className={`px-4 py-2 rounded-full ${view === tab ? "bg-pink-400 text-white" : "bg-gray-200"}`}
          >
            {tab}
          </button>
        ))}
      </div>

      {/* 収入 */}
      {view === "収入" && (
        <div>
          <h2 className="text-xl font-bold mb-4 text-pink-600">収入入力</h2>
          {Object.keys(income).map(key => (
            <div key={key} className="mb-3 flex gap-2 items-center">
              <label className="w-40">{key}</label>
              <input
                type="number"
                value={income[key].amount}
                onChange={e =>
                  setIncome({ ...income, [key]: { ...income[key], amount: e.target.value } })
                }
                className="border p-2 rounded flex-1"
              />
              <select
                value={income[key].owner}
                onChange={e =>
                  setIncome({ ...income, [key]: { ...income[key], owner: e.target.value } })
                }
                className="border p-2 rounded"
              >
                {owners.slice(0, 3).map(o => <option key={o.key} value={o.key}>{o.label}</option>)}
              </select>
            </div>
          ))}
        </div>
      )}

      {/* 支出 */}
      {view === "支出" && (
        <div>
          <h2 className="text-xl font-bold mb-4 text-pink-600">支出入力</h2>
          {Object.keys(expense).map(key => (
            <div key={key} className="mb-3 flex gap-2 items-center">
              <label className="w-40">{key}</label>
              <input
                type="number"
                value={expense[key].amount}
                onChange={e =>
                  setExpense({ ...expense, [key]: { ...expense[key], amount: e.target.value } })
                }
                className="border p-2 rounded flex-1"
              />
              <select
                value={expense[key].owner}
                onChange={e =>
                  setExpense({ ...expense, [key]: { ...expense[key], owner: e.target.value } })
                }
                className="border p-2 rounded"
              >
                {owners.map(o => <option key={o.key} value={o.key}>{o.label}</option>)}
              </select>
            </div>
          ))}
        </div>
      )}

      {/* 集計 */}
      {view === "集計" && (
        <div>
          <h2 className="text-xl font-bold mb-4 text-pink-600">集計結果</h2>
          <p className="mb-1">収入合計: {totalIncome} 円</p>
          <p className="mb-1">支出合計: {totalExpense} 円</p>
          <p className="mb-4 font-bold">
            残高: <span className={balance >= 0 ? "text-green-600" : "text-red-600"}>{balance} 円</span>
          </p>

          <PieChart width={400} height={300}>
            <Pie
              data={pieData}
              cx="50%"
              cy="50%"
              outerRadius={100}
              dataKey="value"
              label
            >
              {pieData.map((entry, index) => (
                <Cell key={`cell-${index}`} fill={entry.color} />
              ))}
            </Pie>
            <Tooltip />
            <Legend />
          </PieChart>
        </div>
          </script>
</body>
</html>
      )}

                                                  
